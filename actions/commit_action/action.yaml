name: "Commit changes"
description: "Commits changes"

inputs:
  commit_message:
    description: Commit message
    required: false
    default: Auto commit changes
  commit_author:
    description: Value used for the commit author. Defaults to the github-actions[bot].
    required: false
    default: "github-actions[bot]"
  commit_user_email:
    description: Email address used for the commit user. Defaults to the 'github-actions[bot]@users.noreply.github.com'
    required: false
    default: "github-actions[bot]@users.noreply.github.com"
  file_pattern:
    description: File pattern used for `git add`. For example `src/*.js`
    required: false
    default: "."

runs:
  using: "composite"
  steps:
    # NOTE: git commit -m <MESSAGE> || echo <MESSAGE>
    # needs the part after OR operator: '|| echo <MESSAGE>'
    # otherwise it'll error if there are no changes to commit
    - name: Set credentials
      run: |
        git config user.email "you@example.com"
        git config user.name ${{ github.actor }}
      shell: bash
    - name: Check for staged changes
      id: check_changes
      run: |
        git add '${{ inputs.file_pattern }}'
        DIFF_CHECK_RESULT=$(git diff --cached --exit-code)
        echo "RESULT=${{ $DIFF_CHECK_RESULT }}" >> $GITHUB_OUTPUT
      shell: bash
    - name: Print check resuls
      run: |
        echo "Check for staged changes RESULT: ${{ steps.check_changes.outputs.RESULT }}"
      shell: bash
    - name: Commit changes
      id: commit_changes
      run: |
        echo "COMMIT_RESULT=true" >> $GITHUB_OUTPUT
        git commit -m '${{ inputs.commit_message }}' || echo "COMMIT_RESULT=false" >> $GITHUB_OUTPUT
      shell: bash
    - name: Push and pull-request
      if: steps.commit_changes.outputs.COMMIT_RESULT == 'true'
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        git push
        gh pr create --title "README.md auto update" --body "README.md has been auto updated by GitHub action"
      shell: bash
